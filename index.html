<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <link rel="stylesheet" href="styles.css">
    <script src="chat.js" defer></script>
    <title>Document</title>
</head>

<body>
    <div class="row container d-flex justify-content-center">
        <div class="col-md-5">
            <div class="card card-bordered">
                <div class="card-header">
                    <h4 class="card-title"><strong>Chat</strong></h4>
                    <a class="btn btn-xs btn-secondary" href="#" data-abc="true">Let's Chat App</a>
                </div>

                <div class="ps-container ps-theme-default ps-active-y" id="chat-content"
                    style="overflow-y: scroll !important; height:700px !important;">
                    <!-- <div class="media media-chat">
                        <img class="avatar" src="https://img.icons8.com/color/36/000000/administrator-male.png"
                            alt="...">
                        <div class="media-body">
                            <p>Hi</p>
                            <p>How are you ...???</p>
                            <p>What are you doing tomorrow?<br> Can we come up a bar?</p>
                            <p class="meta"><time datetime="2018">23:58</time></p>
                        </div>
                    </div>

                    <div class="media media-meta-day">Today</div>

                    <div class="media media-chat media-chat-reverse">
                        <div class="media-body">
                            <p>Hiii, I'm good.</p>
                            <p>How are you doing?</p>
                            <p>Long time no see! Tomorrow office. will be free on sunday.</p>
                            <p class="meta"><time datetime="2018">00:06</time></p>
                        </div>
                    </div>

                    <div class="media media-chat">
                        <img class="avatar" src="https://img.icons8.com/color/36/000000/administrator-male.png"
                            alt="...">
                        <div class="media-body">
                            <p>Okay</p>
                            <p>We will go on sunday? </p>
                            <p class="meta"><time datetime="2018">00:07</time></p>
                        </div>
                    </div> -->
                </div>

                <div class="publisher bt-1 border-light">
                    <img class="avatar avatar-xs" src="https://img.icons8.com/color/36/000000/administrator-male.png"
                        alt="...">
                    <input class="publisher-input" type="text" id="message" placeholder="Write something">
                    <span class="publisher-btn file-group">
                        <i class="fa fa-paperclip file-browser"></i>
                        <input type="file">
                    </span>
                    <a class="publisher-btn" href="#" data-abc="true"><i class="fa fa-smile"></i></a>
                    <a class="publisher-btn text-info" data-abc="true"><i id="send" class="fa fa-paper-plane"></i></a>
                </div>

            </div>
        </div>
    </div>
    
    <script>
        const ws = new WebSocket('ws://localhost:3000');

        ws.addEventListener('message', (e) => {
            const data = JSON.parse(e.data);
            if (data.type === 'message') {
                addMessage(data.data);
            } else if (data.type === 'answer') {
                renderMessage(data.data);
            }
        });
        document.getElementById('send').addEventListener('click', sendMessage);
        document.getElementById('message').addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        function sendMessage() {
            const message = document.getElementById('message');
            if (!message.value) return false;
            ws.send(JSON.stringify({ type: 'message', data: message.value }));
            addMessage(message.value);
            message.value = '';
        }
        function addMessage(message) {
            const chat = document.getElementById('chat-content');
            const container = document.createElement('div');
            const messageBody = document.createElement('div');
            const node = document.createElement('p');
            const nodeTime = document.createElement('p');

            // Get current time
            const date = new Date();
            let time = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            nodeTime.innerHTML = time;
            nodeTime.classList.add('meta');

            // Add classes to elements
            let classes = ['media', 'media-chat', 'media-chat-reverse'];
            container.classList.add(...classes);
            messageBody.classList.add('media-body');

            // Append all DOM elements
            node.innerHTML = message;
            messageBody.appendChild(node);
            messageBody.appendChild(nodeTime);
            container.appendChild(messageBody);
            chat.appendChild(container);

            // Scroll to bottom
            chat.scrollTop = chat.scrollHeight;
        }
        function renderMessage(message) {
            const chat = document.getElementById('chat-content');
            const container = document.createElement('div');
            const messageBody = document.createElement('div');
            const node = document.createElement('p');
            const nodeTime = document.createElement('p');

            // Get current time
            const date = new Date();
            let time = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            nodeTime.innerHTML = time;
            nodeTime.classList.add('meta');

            // Add classes to elements
            let classes = ['media', 'media-chat'];
            container.classList.add(...classes);
            messageBody.classList.add('media-body');

            // Append all DOM elements
            node.innerHTML = message;
            messageBody.appendChild(node);
            messageBody.appendChild(nodeTime);
            container.innerHTML = `<img class="avatar" src="https://img.icons8.com/color/36/000000/administrator-male.png"alt="...">`;
            container.appendChild(messageBody);
            chat.appendChild(container);

            // Scroll to bottom
            chat.scrollTop = chat.scrollHeight;
        }
    </script>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"
        integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>

</html>